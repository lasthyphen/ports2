(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Header:()=>r,buildKeyGenerator:()=>b,buildMemoryStorage:()=>y,buildStorage:()=>v,buildWebStorage:()=>A,canStale:()=>m,createCacheResponse:()=>d,createValidateStatus:()=>s,defaultHeaderInterpreter:()=>i,defaultKeyGenerator:()=>x,defaultRequestInterceptor:()=>u,defaultResponseInterceptor:()=>h,isExpired:()=>w,isMethodIn:()=>o,isStorage:()=>p,setupCache:()=>C,testCachePredicate:()=>f,updateCache:()=>l,updateStaleRequest:()=>c});const a=require("cache-parser"),r=Object.freeze({IfModifiedSince:"if-modified-since",LastModified:"last-modified",IfNoneMatch:"if-none-match",CacheControl:"cache-control",ETag:"etag",Expires:"expires",Age:"age",XAxiosCacheEtag:"x-axios-cache-etag",XAxiosCacheLastModified:"x-axios-cache-last-modified",XAxiosCacheStaleIfError:"x-axios-cache-stale-if-error"}),i=e=>{if(!e)return"not enough headers";const t=e[r.CacheControl];if(t){const{noCache:i,noStore:n,mustRevalidate:s,maxAge:o,immutable:c}=(0,a.parse)(String(t));if(i||n)return"dont cache";if(c)return 31536e6;if(s)return 0;if(o){const t=e[r.Age];return t?1e3*(o-Number(t)):1e3*o}}const i=e[r.Expires];if(i){const e=Date.parse(String(i))-Date.now();return e>=0?e:"dont cache"}return"not enough headers"},n=require("fast-defer");function s(e){return e?t=>e(t)||304===t:e=>e>=200&&e<300||304===e}function o(e="get",t=[]){e=e.toLowerCase();for(const a of t)if(a.toLowerCase()===e)return!0;return!1}function c(e,t){var a;t.headers||(t.headers={});const{etag:i,modifiedSince:n}=t.cache;if(i){const n=!0===i?null===(a=e.data)||void 0===a?void 0:a.headers[r.ETag]:i;n&&(t.headers[r.IfNoneMatch]=n)}n&&(t.headers[r.IfModifiedSince]=!0===n?e.data.headers[r.LastModified]||new Date(e.createdAt).toUTCString():n.toUTCString())}function d(e,t){return 304===e.status&&t?(e.cached=!0,e.data=t.data,e.status=t.status,e.statusText=t.statusText,e.headers=Object.assign(Object.assign({},t.headers),e.headers),t):{data:e.data,status:e.status,statusText:e.statusText,headers:e.headers}}function u(e){const t=async t=>{var a;if(!1===t.cache)return t;if(t.cache=Object.assign(Object.assign({},e.defaults.cache),t.cache),!o(t.method,t.cache.methods))return t;const r=t.id=e.generateKey(t);let i,d=await e.storage.get(r);e:if("empty"===d.state||"stale"===d.state){if(e.waiting[r]){d=await e.storage.get(r);break e}return e.waiting[r]=(0,n.deferred)(),null===(a=e.waiting[r])||void 0===a||a.catch((()=>{})),await e.storage.set(r,{state:"loading",previous:d.state,data:d.data,createdAt:d.createdAt}),"stale"===d.state&&c(d,t),t.validateStatus=s(t.validateStatus),t}if("loading"===d.state){const a=e.waiting[r];if(!a)return await e.storage.remove(r),t;0;try{i=await a}catch(e){return t}}else i=d.data;return t.adapter=()=>Promise.resolve({config:t,data:i.data,headers:i.headers,status:i.status,statusText:i.statusText,cached:!0,id:r}),t};return{onFulfilled:t,apply:()=>e.interceptors.request.use(t)}}async function f(e,t){var a;if("function"==typeof t)return t(e);const{statusCheck:r,responseMatch:i,containsHeaders:n}=t;if(r&&!await r(e.status)||i&&!await i(e))return!1;if(n)for(const t in n){const r=n[t];if(r&&!await r(null!==(a=e.headers[t.toLowerCase()])&&void 0!==a?a:e.headers[t]))return!1}return!0}async function l(e,t,a){for(const r in a){const i=a[r];if("delete"===i){await e.remove(r);continue}const n=await e.get(r);if("loading"===n.state)continue;const s=await i(n,t);"delete"!==s?"ignore"!==s&&await e.set(r,s):await e.remove(r)}}function h(e){const t=async t=>{var a;await e.storage.remove(t),null===(a=e.waiting[t])||void 0===a||a.reject(null),delete e.waiting[t]},a=async a=>{var i,n,s;if(a.id=null!==(i=(s=a.config).id)&&void 0!==i?i:s.id=e.generateKey(a.config),null!==(n=a.cached)&&void 0!==n||(a.cached=!1),a.cached)return a;if(!a.config.cache)return Object.assign(Object.assign({},a),{cached:!1});const o=a.config.cache,c=await e.storage.get(a.id);if("stale"===c.state||"empty"===c.state||"cached"===c.state)return a;if(!c.data&&!await f(a,o.cachePredicate))return await t(a.id),a;for(const e in r)e.startsWith("XAxiosCache")&&delete a.headers[e];o.etag&&!0!==o.etag&&(a.headers[r.XAxiosCacheEtag]=o.etag),o.modifiedSince&&(a.headers[r.XAxiosCacheLastModified]=!0===o.modifiedSince?"use-cache-timestamp":o.modifiedSince.toUTCString());let u=o.ttl||-1;if(null==o?void 0:o.interpretHeader){const r=e.headerInterpreter(a.headers);if("dont cache"===r)return await t(a.id),a;u="not enough headers"===r?u:r}const h=d(a,c.data);"function"==typeof u&&(u=await u(a)),o.staleIfError&&(a.headers[r.XAxiosCacheStaleIfError]=String(u)),(null==o?void 0:o.update)&&await l(e.storage,a,o.update);const g={state:"cached",ttl:u,createdAt:Date.now(),data:h},p=e.waiting[a.id];return p&&(p.resolve(g.data),delete e.waiting[a.id]),await e.storage.set(a.id,g),a},i=async a=>{var r;const i=a.config;if(!i||!1===i.cache||!i.id)throw a;const n=await e.storage.get(i.id),s=i.cache;if("loading"!==n.state||"stale"!==n.previous)throw await t(i.id),a;if(null==s?void 0:s.staleIfError){const t="function"==typeof s.staleIfError?await s.staleIfError(a.response,n,a):s.staleIfError;if(!0===t||"number"==typeof t&&n.createdAt+t>Date.now())return null===(r=e.waiting[i.id])||void 0===r||r.resolve(n.data),delete e.waiting[i.id],await e.storage.set(i.id,{state:"stale",createdAt:Date.now(),data:n.data}),{cached:!0,config:i,id:i.id,data:n.data.data,headers:n.data.headers,status:n.data.status,statusText:n.data.statusText}}throw a};return{onFulfilled:a,onRejected:i,apply:()=>e.interceptors.response.use(a,i)}}const g=Symbol(),p=e=>!!e&&!!e[g];function m(e){const t=e.data.headers;return r.ETag in t||r.LastModified in t||r.XAxiosCacheEtag in t||r.XAxiosCacheStaleIfError in t||r.XAxiosCacheLastModified in t}function w(e){return e.createdAt+e.ttl<=Date.now()}function v({set:e,find:t,remove:a}){return{[g]:1,set:e,remove:a,get:async r=>{const i=await t(r);if(!i)return{state:"empty"};if("cached"!==i.state||!w(i))return i;if(m(i)){const t={state:"stale",createdAt:i.createdAt,data:i.data};return await e(r,t),t}return await a(r),{state:"empty"}}}}function y(){const e=v({find:t=>e.data[t],set:(t,a)=>{e.data[t]=a},remove:t=>{delete e.data[t]}});return e.data=Object.create(null),e}const S=require("object-code"),I=/^\/|\/$/g;function b(e){return t=>{if(t.id)return t.id;const a=e(t);return"string"==typeof a||"number"==typeof a?`${a}`:`${(0,S.hash)(a)}`}}const x=b((({baseURL:e="",url:t="",method:a="get",params:r,data:i})=>(e&&(e=e.replace(I,"")),t&&(t=t.replace(I,"")),a&&(a=a.toLowerCase()),{url:e+(e&&t?"/":"")+t,params:r,method:a,data:i})));function C(e,t={}){var a,r,n,s,o;const c=e;if(c.storage=t.storage||y(),!p(c.storage))throw new Error("Use buildStorage() function");return c.generateKey=t.generateKey||x,c.waiting=t.waiting||{},c.headerInterpreter=t.headerInterpreter||i,c.requestInterceptor=t.requestInterceptor||u(c),c.responseInterceptor=t.responseInterceptor||h(c),c.debug=t.debug,c.defaults.cache={ttl:null!==(a=t.ttl)&&void 0!==a?a:3e5,interpretHeader:null!==(r=t.interpretHeader)&&void 0!==r&&r,methods:t.methods||["get"],cachePredicate:t.cachePredicate||{statusCheck:e=>e>=200&&e<400},etag:null!==(n=t.etag)&&void 0!==n&&n,modifiedSince:null!==(s=t.modifiedSince)&&void 0!==s&&s,staleIfError:null!==(o=t.staleIfError)&&void 0!==o&&o,update:t.update||{}},c.requestInterceptor.apply(),c.responseInterceptor.apply(),c}function A(e,t=""){return v({find:a=>{const r=e.getItem(t+a);return r?JSON.parse(r):void 0},remove:a=>{e.removeItem(t+a)},set:(a,r)=>{const i=()=>e.setItem(t+a,JSON.stringify(r));try{return i()}catch(r){const n=Object.entries(e).filter((([a])=>a.startsWith(t)&&e.getItem(a))).map((([e,t])=>[e,JSON.parse(t)]));for(const[t,a]of n)"cached"===a.state&&w(a)&&!m(a)&&e.removeItem(t);try{return i()}catch(t){const a=n.sort((([,e],[,t])=>(e.createdAt||0)-(t.createdAt||0)));for(const[t]of a){e.removeItem(t);try{return i()}catch(e){}}}e.removeItem(t+a)}}})}module.exports=t})();