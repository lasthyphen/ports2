{"version":3,"file":"next-swagger-doc.cjs.production.min.js","sources":["../src/with-swagger.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\nimport { join } from 'path';\n\nimport swaggerJsdoc from 'swagger-jsdoc';\n\ntype SwaggerOptions = {\n  openApiVersion?: string;\n  apiFolder?: string;\n  title: string;\n  version: string;\n};\n\n/**\n * Create swagger JSON\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns Swagger JSON Spec\n *\n * @example\n * createSwaggerSpec({\n *  openApiVersion: '3.0.0',\n *  apiFolder:  'pages/api',\n *  title: 'Demo Api',\n *  version: '1.0',\n * })\n */\nexport function createSwaggerSpec({\n  openApiVersion = '3.0.0',\n  apiFolder = 'pages/api',\n  title,\n  version,\n}: SwaggerOptions) {\n  const apiDirectory = join(process.cwd(), apiFolder);\n  const buildApiDirectory = join(process.cwd(), '.next/server', apiFolder);\n\n  const options = {\n    definition: {\n      openapi: openApiVersion,\n      info: {\n        title,\n        version,\n      },\n    },\n    apis: [\n      `${apiDirectory}/**/*.js`,\n      `${apiDirectory}/**/*.ts`,\n      `${apiDirectory}/**/*.tsx`,\n      `${buildApiDirectory}/**/*.js`,\n    ], // files containing annotations as above\n  };\n\n  return swaggerJsdoc(options);\n}\n\n/**\n * withSwagger middleware\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns\n *\n * @example\n * createSwaggerSpec({\n *  openApiVersion: '3.0.0',\n *  apiFolder:  'pages/api',\n *  title: 'Demo Api',\n *  version: '1.0',\n * })\n */\nexport function withSwagger({\n  openApiVersion = '3.0.0',\n  apiFolder = 'pages/api',\n  title,\n  version,\n}: SwaggerOptions) {\n  return () => {\n    return (_req: NextApiRequest, res: NextApiResponse) => {\n      try {\n        const swaggerSpec = createSwaggerSpec({\n          openApiVersion,\n          apiFolder,\n          title,\n          version,\n        });\n        res.status(200).send(swaggerSpec);\n      } catch (error) {\n        res.status(400).send(error);\n      }\n    };\n  };\n}\n"],"names":["createSwaggerSpec","openApiVersion","apiFolder","title","version","apiDirectory","join","process","cwd","buildApiDirectory","swaggerJsdoc","definition","openapi","info","apis","_req","res","swaggerSpec","status","send","error"],"mappings":"mLA4BgBA,aACdC,eAAAA,aAAiB,cACjBC,UAAAA,aAAY,cACZC,IAAAA,MACAC,IAAAA,QAEMC,EAAeC,OAAKC,QAAQC,MAAON,GACnCO,EAAoBH,OAAKC,QAAQC,MAAO,eAAgBN,UAkBvDQ,EAhBS,CACdC,WAAY,CACVC,QAASX,EACTY,KAAM,CACJV,MAAAA,EACAC,QAAAA,IAGJU,KAAM,CACDT,aACAA,aACAA,cACAI,oFAwBPR,eAAAA,aAAiB,cACjBC,UAAAA,aAAY,cACZC,IAAAA,MACAC,IAAAA,eAEO,kBACE,SAACW,EAAsBC,WAEpBC,EAAcjB,EAAkB,CACpCC,eAAAA,EACAC,UAAAA,EACAC,MAAAA,EACAC,QAAAA,IAEFY,EAAIE,OAAO,KAAKC,KAAKF,GACrB,MAAOG,GACPJ,EAAIE,OAAO,KAAKC,KAAKC"}